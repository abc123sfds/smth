<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IB Grades – Circular Slider Version</title>
<style>
  :root {
    --bg: #ffffff;
    --muted: #555555;
    --glass: rgba(0,0,0,0.03);
    font-family: Inter, system-ui, sans-serif;
  }
  body {
    margin: 0;
    background: var(--bg);
    color: #1a1a1a;
  }
  .wrap {
    max-width: 1100px;
    margin: 30px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .panel {
    background: var(--glass);
    padding: 18px;
    border-radius: 12px;
    color: #1a1a1a;
  }
  .subjects {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }
  .subject {
    display: flex;
    gap: 14px;
    align-items: center;
    padding: 10px;
    border-radius: 12px;
    background: rgba(0,0,0,0.02);
  }
  .circle {
    width: 90px;
    height: 90px;
    position: relative;
    cursor: grab;
    user-select: none;
  }
  .circle:active {
    cursor: grabbing;
  }
  .circle svg {
    width: 90px;
    height: 90px;
    transform: rotate(-90deg);
  }
  .circle .label {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    pointer-events: none;
    color: #1a1a1a;
  }
  .controls {
    flex: 1;
  }
  .name {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
    color: #1a1a1a;
  }
  .name[contenteditable] {
    border-bottom: 1px dashed rgba(0,0,0,0.1);
    outline: none;
    padding-bottom: 2px;
  }
  select {
    width: 100%;
    padding: 6px;
    border-radius: 6px;
    background: #f5f5f5;
    color: #1a1a1a;
    border: 1px solid rgba(0,0,0,0.08);
    margin-top: 6px;
  }
  .big-circle {
    width: 180px;
    height: 180px;
    margin: 20px auto 0 auto;
    position: relative;
  }
  .big-circle svg {
    width: 180px;
    height: 180px;
    transform: rotate(-90deg);
  }
  .big-inner {
    position: absolute;
    inset: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
  }
  .total-points {
    font-size: 34px;
    font-weight: 800;
    color: #1a1a1a;
  }
  .fail {
    margin-top: 8px;
    background: rgba(255,80,80,0.12);
    padding: 8px;
    border-radius: 8px;
    color: #c0392b;
    font-weight: 600;
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- SUBJECTS PANEL -->
  <div class="panel">
    <h1 style="margin-top:0;font-size:20px">IB Subjects</h1>
    <div class="subjects" id="subjectsList"></div>

    <div style="margin-top:20px;display:flex;gap:12px">
      <div style="flex:1">
        <div style="font-weight:700">TOK</div>
        <select id="tokSelect">
          <option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
        </select>
      </div>
      <div style="flex:1">
        <div style="font-weight:700">EE</div>
        <select id="eeSelect">
          <option>A</option><option>B</option><option>C</option><option>D</option><option>E</option>
        </select>
      </div>
    </div>

    <div id="failNote"></div>
  </div>

  <!-- TOTAL POINTS PANEL BELOW -->
  <div class="panel">
    <h2 style="margin-top:0;font-size:18px;text-align:center">Total Points</h2>
    <div class="big-circle">
      <svg viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="52" stroke="rgba(0,0,0,0.06)" stroke-width="12" fill="none"></circle>
        <circle id="totalArc" cx="60" cy="60" r="52" stroke-width="12"
          stroke-linecap="round" fill="none" stroke-dasharray="0 999"></circle>
      </svg>
      <div class="big-inner">
        <div class="total-points" id="totalPoints">0</div>
        <div style="font-size:12px;color:#555555">/45</div>
      </div>
    </div>
  </div>

</div>

<script>
// ---------- Utility: color interpolation ----------
function gradeColor(g) {
  const ratio = (g - 1) / 6;  
  const hue = 120 * ratio;  
  return `hsl(${hue} 70% 40%)`;
}

// ---------- TOK–EE matrix ----------
const matrix = {
  A:{A:3,B:3,C:2,D:2,E:"F"}, B:{A:3,B:2,C:2,D:1,E:"F"},
  C:{A:2,B:2,C:1,D:0,E:0}, D:{A:2,B:1,C:0,D:0,E:0},
  E:{A:"F",B:"F",C:"F",D:"F",E:"F"}
};

// ---------- Subject list ----------
let subjects = [
  {name:"Mathematics HL", grade:6},
  {name:"Physics HL", grade:6},
  {name:"Chemistry HL", grade:6},
  {name:"Biology SL", grade:6},
  {name:"English A SL", grade:6},
  {name:"Economics SL", grade:6}
];

const list = document.getElementById("subjectsList");
const totalArc = document.getElementById("totalArc");
const totalPointsEl = document.getElementById("totalPoints");
const failNote = document.getElementById("failNote");

// ---------- Build subject UI ----------
subjects.forEach((s, i) => {
  const div = document.createElement("div");
  div.className = "subject";
  div.dataset.index = i;

  div.innerHTML = `
    <div class="circle" data-i="${i}">
      <svg viewBox="0 0 100 100">
        <circle cx="50" cy="50" r="42"
          stroke="rgba(0,0,0,0.09)" stroke-width="12" fill="none"></circle>
        <circle class="arc" cx="50" cy="50" r="42"
          stroke-width="12" stroke-linecap="round" fill="none" stroke-dasharray="0 999"></circle>
      </svg>
      <div class="label">${s.grade}</div>
    </div>

    <div class="controls">
      <div class="name" contenteditable="true">${s.name}</div>
    </div>
  `;
  list.appendChild(div);
});

// ---------- Circular slider interaction ----------
function angleToGrade(angleDeg) {
  const adj = (angleDeg + 360) % 360;  
  const ratio = adj / 360;
  let g = 1 + ratio * 6;
  return Math.min(7, Math.max(1, Math.round(g)));
}

function updateSubject(i, grade) {
  subjects[i].grade = grade;
  const wrap = document.querySelector(`.circle[data-i="${i}"]`);
  const arc = wrap.querySelector(".arc");
  const label = wrap.querySelector(".label");

  const circ = 2 * Math.PI * 42;
  const ratio = (grade - 1) / 6;
  arc.setAttribute("stroke-dasharray", `${ratio*circ} ${circ}`);
  arc.setAttribute("stroke", gradeColor(grade));
  label.textContent = grade;

  updateTotal();
}

list.addEventListener("mousedown", startDrag);
list.addEventListener("touchstart", startDrag, {passive:false});

let dragging = null;

function startDrag(e) {
  let target = e.target.closest(".circle");
  if(!target) return;

  dragging = target.dataset.i;
  document.addEventListener("mousemove", drag);
  document.addEventListener("mouseup", stopDrag);
  document.addEventListener("touchmove", drag, {passive:false});
  document.addEventListener("touchend", stopDrag);

  drag(e);
}

function drag(e) {
  if(dragging === null) return;
  e.preventDefault();

  const circle = document.querySelector(`.circle[data-i="${dragging}"]`);
  const rect = circle.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;

  const x = (e.touches ? e.touches[0].clientX : e.clientX) - cx;
  const y = (e.touches ? e.touches[0].clientY : e.clientY) - cy;

  const angle = Math.atan2(y, x) * 180/Math.PI + 90;
  let grade = angleToGrade(angle);
  updateSubject(Number(dragging), grade);
}

function stopDrag() {
  dragging = null;
  document.removeEventListener("mousemove", drag);
  document.removeEventListener("mouseup", stopDrag);
  document.removeEventListener("touchmove", drag);
  document.removeEventListener("touchend", stopDrag);
}

// ---------- Total calculation ----------
function updateTotal() {
  const sum = subjects.reduce((a,s)=>a+s.grade, 0);
  const tok = document.getElementById("tokSelect").value;
  const ee = document.getElementById("eeSelect").value;

  let bonus = matrix[ee][tok];
  let failing = (bonus === "F");

  if(failing) bonus = 0;

  const total = sum + bonus;

  const ratio = total / 45;
  const circ = 2*Math.PI*52;
  totalArc.setAttribute("stroke-dasharray", `${ratio*circ} ${circ}`);
  totalArc.setAttribute("stroke", `hsl(${120*ratio} 70% 40%)`);

  totalPointsEl.textContent = total;

  failNote.innerHTML =
    failing ? `<div class="fail">Failing condition: TOK or EE = E</div>` : "";
}

document.getElementById("tokSelect").onchange = updateTotal;
document.getElementById("eeSelect").onchange = updateTotal;

updateTotal();
subjects.forEach((s,i)=>updateSubject(i,s.grade));
</script>
</body>
</html>
